(function(define){var __define;"function"==typeof define&&define.amd&&(__define=define,define=null);
var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire1d24;t.register("2h0yV",(function(e,r){var n=e.exports&&e.exports.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.WalletPolicy=e.exports.DefaultWalletPolicy=e.exports.PsbtV2=e.exports.AppClient=void 0;const i=n(t("6hBYL"));e.exports.AppClient=i.default;var s=t("lu4xX");Object.defineProperty(e.exports,"DefaultWalletPolicy",{enumerable:!0,get:function(){return s.DefaultWalletPolicy}}),Object.defineProperty(e.exports,"WalletPolicy",{enumerable:!0,get:function(){return s.WalletPolicy}});var o=t("loYOe");Object.defineProperty(e.exports,"PsbtV2",{enumerable:!0,get:function(){return o.PsbtV2}}),e.exports.default=i.default})),t.register("6hBYL",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.AppClient=e.exports.PartialSignature=void 0;var i=t("26LFE"),s=t("aZj5D"),o=t("7W7dC"),a=t("htZV9"),u=t("loYOe"),l=t("6W3U6");var p,h,c,f;(h=p||(p={}))[h.GET_PUBKEY=0]="GET_PUBKEY",h[h.REGISTER_WALLET=2]="REGISTER_WALLET",h[h.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",h[h.SIGN_PSBT=4]="SIGN_PSBT",h[h.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT",h[h.SIGN_MESSAGE=16]="SIGN_MESSAGE",(f=c||(c={}))[f.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED";class d{constructor(t,e,r){this.pubkey=t,this.signature=e,this.tapleafHash=r}}function I(t,e){if(64==t.length)return new d(t.slice(0,32),e,t.slice(32,64));if(32==t.length||33==t.length)return new d(t,e);throw new Error(`Invalid length for pubkeyAugm: ${t.length} bytes.`)}e.exports.PartialSignature=d;class g{async makeRequest(t,e,r){let n=await this.transport.send(225,t,0,1,e,[36864,57344]);for(;57344===n.readUInt16BE(n.length-2);){if(!r)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");const t=n.slice(0,-2),e=r.execute(t);n=await this.transport.send(248,c.CONTINUE_INTERRUPTED,0,0,e,[36864,57344])}return n.slice(0,-2)}async getAppAndVersion(){const t=await this.transport.send(176,1,0,0);let e=0;if(1!==t[e++])throw new Error("Unexpected response");const r=t[e++],n=t.slice(e,e+=r).toString("ascii"),i=t[e++],s=t.slice(e,e+=i).toString("ascii"),o=t[e++];return{name:n,version:s,flags:t.slice(e,e+=o)}}async getExtendedPubkey(t,e=!1){const r=(0,i.pathStringToArray)(t);if(r.length>6)throw new Error("Path too long. At most 6 levels allowed.");return(await this.makeRequest(p.GET_PUBKEY,n.concat([n.from(e?[1]:[0]),(0,i.pathElementsToBuffer)(r)]))).toString("ascii")}async registerWallet(t){await this.validatePolicy(t);const e=new s.ClientCommandInterpreter;e.addKnownWalletPolicy(t);const r=t.serialize(),i=await this.makeRequest(p.REGISTER_WALLET,n.concat([(0,l.createVarint)(r.length),r]),e);if(64!=i.length)throw Error(`Invalid response length. Expected 64 bytes, got ${i.length}`);return[i.subarray(0,32),i.subarray(32)]}async getWalletAddress(t,e,r,i,o){if(0!==r&&1!==r)throw new Error("Change can only be 0 or 1");if(i<0||!Number.isInteger(i))throw new Error("Invalid address index");if(null!=e&&32!=e.length)throw new Error("Invalid HMAC length");await this.validatePolicy(t);const a=new s.ClientCommandInterpreter;a.addKnownWalletPolicy(t);const u=n.alloc(4);u.writeUInt32BE(i,0);return(await this.makeRequest(p.GET_WALLET_ADDRESS,n.concat([n.from(o?[1]:[0]),t.getId(),e||n.alloc(32,0),n.from([r]),u]),a)).toString("ascii")}async signPsbt(t,e,r,i){if(await this.validatePolicy(e),"string"==typeof t&&(t=n.from(t,"base64")),n.isBuffer(t)){const e=new u.PsbtV2;e.deserialize(t),t=e}const h=new o.MerkelizedPsbt(t);if(null!=r&&32!=r.length)throw new Error("Invalid HMAC length");const c=new s.ClientCommandInterpreter(i);c.addKnownWalletPolicy(e),c.addKnownMapping(h.globalMerkleMap);for(const t of h.inputMerkleMaps)c.addKnownMapping(t);for(const t of h.outputMerkleMaps)c.addKnownMapping(t);c.addKnownList(h.inputMapCommitments);const f=new a.Merkle(h.inputMapCommitments.map((t=>(0,a.hashLeaf)(t)))).getRoot();c.addKnownList(h.outputMapCommitments);const d=new a.Merkle(h.outputMapCommitments.map((t=>(0,a.hashLeaf)(t)))).getRoot();await this.makeRequest(p.SIGN_PSBT,n.concat([h.getGlobalKeysValuesRoot(),(0,l.createVarint)(h.getGlobalInputCount()),f,(0,l.createVarint)(h.getGlobalOutputCount()),d,e.getId(),r||n.alloc(32,0)]),c);const g=c.getYielded(),E=[];for(const t of g){const[e,r]=(0,l.parseVarint)(t,0),n=t[r],i=I(t.subarray(r+1,r+1+n),t.subarray(r+1+n));E.push([Number(e),i])}return E}async getMasterFingerprint(){return(await this.makeRequest(p.GET_MASTER_FINGERPRINT,n.from([]))).toString("hex")}async signMessage(t,e){const r=(0,i.pathStringToArray)(e),o=new s.ClientCommandInterpreter,u=Math.ceil(t.length/64),h=[];for(let e=0;e<u;e++)h.push(t.subarray(64*e,64*e+64));o.addKnownList(h);const c=new a.Merkle(h.map((t=>(0,a.hashLeaf)(t)))).getRoot();return(await this.makeRequest(p.SIGN_MESSAGE,n.concat([(0,i.pathElementsToBuffer)(r),(0,l.createVarint)(t.length),c]),o)).toString("base64")}async validatePolicy(t){if((t.descriptorTemplate.match(/[asctdvjnlu]+:/g)||[]).some((t=>t.includes("a")))){const t=await this.getAppAndVersion();if(["2.1.0","2.1.1"].includes(t.version))throw new Error("Please update your Ledger Bitcoin app.")}}constructor(t){this.transport=t}}e.exports.AppClient=g,e.exports.default=g})),t.register("26LFE",(function(e,r){var n=t("6rT8n").Buffer,i=e.exports&&e.exports.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.hardenedPathOf=e.exports.getXpubComponents=e.exports.pubkeyFromXpub=e.exports.pathStringToArray=e.exports.pathArrayToString=e.exports.bip32asBuffer=e.exports.pathElementsToBuffer=void 0;const s=i(t("9UXyL")),o=i(t("f8pp6"));function a(t){const e=n.alloc(1+4*t.length);return e[0]=t.length,t.forEach(((t,r)=>{e.writeUInt32BE(t,1+4*r)})),e}function u(t){return"m"==t||""==t?[]:s.default.fromString(t).toPathArray()}e.exports.pathElementsToBuffer=a,e.exports.bip32asBuffer=function(t){return a(t?u(t):[])},e.exports.pathArrayToString=function(t){return 0==t.length?"m":s.default.fromPathArray(t).toString()},e.exports.pathStringToArray=u,e.exports.pubkeyFromXpub=function(t){const e=o.default.decode(t);return e.slice(e.length-33)},e.exports.getXpubComponents=function(t){const e=o.default.decode(t);return{chaincode:e.slice(13,45),pubkey:e.slice(e.length-33),version:e.readUInt32BE(0)}},e.exports.hardenedPathOf=function(t){for(let e=t.length-1;e>=0;e--)if(t[e]>=2147483648)return t.slice(0,e+1);return[]}})),t.register("9UXyL",(function(t,e){const r=2147483648;var n=function(t){if(!Array.isArray(t))throw new Error("Input must be an Array");if(0===t.length)throw new Error("Path must contain at least one level");for(var e=0;e<t.length;e++)if("number"!=typeof t[e])throw new Error("Path element is not a number");this.path=t};n.validatePathArray=function(t){try{return n.fromPathArray(t),!0}catch(t){return!1}},n.validateString=function(t,e){try{return n.fromString(t,e),!0}catch(t){return!1}},n.fromPathArray=function(t){return new n(t)},n.fromString=function(t,e){if(/^m\//i.test(t))t=t.slice(2);else if(e)throw new Error("Root element is required");for(var i=t.split("/"),s=new Array(i.length),o=0;o<i.length;o++){var a=/(\d+)([hH\']?)/.exec(i[o]);if(null===a)throw new Error("Invalid input");if(s[o]=parseInt(a[1],10),s[o]>=r)throw new Error("Invalid child index");if("h"===a[2]||"H"===a[2]||"'"===a[2])s[o]+=r;else if(0!=a[2].length)throw new Error("Invalid modifier")}return new n(s)},n.prototype.toPathArray=function(){return this.path},n.prototype.toString=function(t,e){for(var n=new Array(this.path.length),i=0;i<this.path.length;i++){var s=this.path[i];n[i]=s&r?(2147483647&s)+(e?"h":"'"):s}return(t?"":"m/")+n.join("/")},n.prototype.inspect=function(){return"BIPPath <"+this.toString()+">"},t.exports=n})),t.register("aZj5D",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.ClientCommandInterpreter=e.exports.GetMoreElementsCommand=e.exports.GetMerkleLeafIndexCommand=e.exports.GetMerkleLeafProofCommand=e.exports.GetPreimageCommand=e.exports.YieldCommand=void 0;var i,s,o=t("5GnSC"),a=t("8ziCY"),u=t("htZV9"),l=t("6W3U6");(s=i||(i={}))[s.YIELD=16]="YIELD",s[s.GET_PREIMAGE=64]="GET_PREIMAGE",s[s.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",s[s.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",s[s.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS";class p{}class h extends p{execute(t){return this.results.push(n.from(t.subarray(1))),this.progressCallback&&this.progressCallback(),n.from("")}constructor(t,e){super(),this.progressCallback=e,this.code=i.YIELD,this.results=t}}e.exports.YieldCommand=h;class c extends p{execute(t){const e=n.from(t.subarray(1));if(33!=e.length)throw new Error("Invalid request, unexpected trailing data");if(0!=e[0])throw new Error("Unsupported request, the first byte should be 0");const r=n.alloc(32);for(let t=0;t<32;t++)r[t]=e[1+t];const i=r.toString("hex"),s=this.known_preimages.get(i);if(null!=s){const t=(0,l.createVarint)(s.length),e=255-t.length-1,r=Math.min(e,s.length);if(r<s.length)for(let t=r;t<s.length;t++)this.queue.push(n.from([s[t]]));return n.concat([t,n.from([r]),n.from(s.subarray(0,r))])}throw Error(`Requested unknown preimage for: ${i}`)}constructor(t,e){super(),this.code=i.GET_PREIMAGE,this.known_preimages=t,this.queue=e}}e.exports.GetPreimageCommand=c;class f extends p{execute(t){const e=n.from(t.subarray(1));if(e.length<34)throw new Error("Invalid request, expected at least 34 bytes");const r=new a.BufferReader(e),i=r.readSlice(32).toString("hex");let s,o;try{s=(0,l.sanitizeBigintToNumber)(r.readVarInt()),o=(0,l.sanitizeBigintToNumber)(r.readVarInt())}catch(t){throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}const u=this.known_trees.get(i);if(!u)throw Error(`Requested Merkle leaf proof for unknown tree: ${i}`);if(o>=s||u.size()!=s)throw Error("Invalid index or tree size.");if(0!=this.queue.length)throw Error("This command should not execute when the queue is not empty.");const p=u.getProof(o),h=Math.min(Math.floor(6.90625),p.length),c=p.length-h;return c>0&&this.queue.push(...p.slice(-c)),n.concat([u.getLeafHash(o),n.from([p.length]),n.from([h]),...p.slice(0,h)])}constructor(t,e){super(),this.code=i.GET_MERKLE_LEAF_PROOF,this.known_trees=t,this.queue=e}}e.exports.GetMerkleLeafProofCommand=f;class d extends p{execute(t){const e=n.from(t.subarray(1));if(64!=e.length)throw new Error("Invalid request, unexpected trailing data");const r=n.alloc(32);for(let t=0;t<32;t++)r[t]=e.readUInt8(t);const i=r.toString("hex"),s=n.alloc(32);for(let t=0;t<32;t++)s[t]=e.readUInt8(32+t);const o=s.toString("hex"),a=this.known_trees.get(i);if(!a)throw Error(`Requested Merkle leaf index for unknown root: ${i}`);let u=0,p=0;for(let t=0;t<a.size();t++)if(a.getLeafHash(t).toString("hex")==o){p=1,u=t;break}return n.concat([n.from([p]),(0,l.createVarint)(u)])}constructor(t){super(),this.code=i.GET_MERKLE_LEAF_INDEX,this.known_trees=t}}e.exports.GetMerkleLeafIndexCommand=d;class I extends p{execute(t){if(1!=t.length)throw new Error("Invalid request, unexpected trailing data");if(0===this.queue.length)throw new Error("No elements to get");const e=this.queue[0].length;if(this.queue.some((t=>t.length!=e)))throw new Error("The queue contains elements with different byte length, which is not expected");const r=Math.floor(253/e),i=Math.min(r,this.queue.length),s=this.queue.splice(0,i);return n.concat([n.from([i]),n.from([e]),...s])}constructor(t){super(),this.code=i.GET_MORE_ELEMENTS,this.queue=t}}e.exports.GetMoreElementsCommand=I;e.exports.ClientCommandInterpreter=class{getYielded(){return this.yielded}addKnownPreimage(t){this.preimages.set(o.crypto.sha256(t).toString("hex"),t)}addKnownList(t){for(const e of t){const t=n.concat([n.from([0]),e]);this.addKnownPreimage(t)}const e=new u.Merkle(t.map((t=>(0,u.hashLeaf)(t))));this.roots.set(e.getRoot().toString("hex"),e)}addKnownMapping(t){this.addKnownList(t.keys),this.addKnownList(t.values)}addKnownWalletPolicy(t){this.addKnownPreimage(t.serialize()),this.addKnownList(t.keys.map((t=>n.from(t,"ascii")))),this.addKnownPreimage(n.from(t.descriptorTemplate))}execute(t){if(0==t.length)throw new Error("Unexpected empty command");const e=t[0],r=this.commands.get(e);if(!r)throw new Error(`Unexpected command code ${e}`);return r.execute(t)}constructor(t){this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;const e=[new h(this.yielded,t),new c(this.preimages,this.queue),new d(this.roots),new f(this.roots,this.queue),new I(this.queue)];for(const t of e){if(this.commands.has(t.code))throw new Error(`Multiple commands with code ${t.code}`);this.commands.set(t.code,t)}}}})),t.register("8ziCY",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.BufferReader=e.exports.BufferWriter=e.exports.unsafeFrom64bitLE=e.exports.unsafeTo64bitLE=void 0;var i=t("6W3U6");function s(t){if(t>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");const e=n.alloc(8,0);for(let r=0;r<e.length;r++){const n=255&t;e[r]=n,t=(t-n)/256}return e}function o(t){let e=0;if(8!=t.length)throw new Error("Expected Bufffer of lenght 8");if(0!=t[7])throw new Error("Can't encode numbers > MAX_SAFE_INT");if(t[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(let r=t.length-1;r>=0;r--)e=256*e+t[r];return e}e.exports.unsafeTo64bitLE=s,e.exports.unsafeFrom64bitLE=o;e.exports.BufferWriter=class{write(t,e){const r=n.alloc(t);e(r),this.bufs.push(r)}writeUInt8(t){this.write(1,(e=>e.writeUInt8(t,0)))}writeInt32(t){this.write(4,(e=>e.writeInt32LE(t,0)))}writeUInt32(t){this.write(4,(e=>e.writeUInt32LE(t,0)))}writeUInt64(t){const e=s(t);this.writeSlice(e)}writeVarInt(t){this.bufs.push((0,i.createVarint)(t))}writeSlice(t){this.bufs.push(n.from(t))}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}buffer(){return n.concat(this.bufs)}constructor(){this.bufs=[]}};e.exports.BufferReader=class{available(){return this.buffer.length-this.offset}readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){return o(this.readSlice(8))}readVarInt(){const[t,e]=(0,i.parseVarint)(this.buffer,this.offset);return this.offset+=e,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}readVarSlice(){const t=(0,i.sanitizeBigintToNumber)(this.readVarInt());return this.readSlice(t)}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}constructor(t,e=0){this.buffer=t,this.offset=e}}})),t.register("6W3U6",(function(e,r){var n=t("6rT8n").Buffer;function i(t,e,r){let n=BigInt(0);for(let i=0;i<r;i++){if(null==t[i+e])throw Error("Buffer too small");n+=BigInt(t[i+e])<<BigInt(8*i)}return n}function s(t){if(t<0)throw RangeError("Negative bigint is not a valid varint");if(t>Number.MAX_SAFE_INTEGER)throw RangeError("Too large for a Number");return Number(t)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.createVarint=e.exports.parseVarint=e.exports.sanitizeBigintToNumber=void 0,e.exports.sanitizeBigintToNumber=s,e.exports.parseVarint=function(t,e){if(e<0)throw RangeError("Negative offset is invalid");if(null==t[e])throw Error("Buffer too small");if(t[e]<253)return[BigInt(t[e]),1];{let r;return r=253===t[e]?2:254===t[e]?4:8,[i(t,e+1,r),r+1]}},e.exports.createVarint=function(t){"number"==typeof t&&(t=s(t));const e=function(t){if("number"==typeof t&&(t=s(t)),t<BigInt(0))throw new RangeError("Negative numbers are not supported");if(t>=BigInt(1)<<BigInt(64))throw new RangeError("Too large for a Bitcoin-style varint");return t<BigInt(253)?1:t<=BigInt(65535)?3:t<=BigInt(4294967295)?5:9}(t);t=BigInt(t);const r=n.alloc(e);return 1==e?r[0]=Number(t):(r[0]=3==e?253:5===e?254:255,function(t,e,r,n){for(let i=0;i<e;i++){if(null==r[i+n])throw Error("Buffer too small");r[i+n]=Number(t%BigInt(256)),t>>=BigInt(8)}}(t,e-1,r,1)),r}})),t.register("htZV9",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.hashLeaf=e.exports.Merkle=void 0;var i=t("5GnSC");e.exports.Merkle=class{getRoot(){return this.rootNode.hash}size(){return this.leaves.length}getLeaves(){return this.leaves}getLeafHash(t){return this.leafNodes[t].hash}getProof(t){if(t>=this.leaves.length)throw Error("Index out of bounds");return o(this.leafNodes[t])}calculateRoot(t){const e=t.length;if(0==e)return{root:new s(void 0,void 0,n.alloc(32,0)),leaves:[]};if(1==e){const e=new s(void 0,void 0,t[0]);return{root:e,leaves:[e]}}const r=function(t){if(t<2)throw Error("Expected n >= 2");return function(t){return 0==(t&t-1)}(t)?t/2:1<<Math.floor(Math.log2(t))}(e),i=this.calculateRoot(t.slice(0,r)),o=this.calculateRoot(t.slice(r)),a=i.root,u=o.root,l=this.hashNode(a.hash,u.hash),p=new s(a,u,l);return a.parent=p,u.parent=p,{root:p,leaves:i.leaves.concat(o.leaves)}}hashNode(t,e){return this.h(n.concat([n.from([1]),t,e]))}constructor(t,e=i.crypto.sha256){this.leaves=t,this.h=e;const r=this.calculateRoot(t);this.rootNode=r.root,this.leafNodes=r.leaves}},e.exports.hashLeaf=function(t,e=i.crypto.sha256){return function(t,e,r){return r(n.concat([t,e]))}(n.from([0]),t,e)};class s{isLeaf(){return null==this.leftChild}constructor(t,e,r){this.leftChild=t,this.rightChild=e,this.hash=r}}function o(t){if(!t.parent)return[];if(t.parent.leftChild==t){if(!t.parent.rightChild)throw new Error("Expected right child to exist");return[t.parent.rightChild.hash,...o(t.parent)]}if(!t.parent.leftChild)throw new Error("Expected left child to exist");return[t.parent.leftChild.hash,...o(t.parent)]}})),t.register("7W7dC",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MerkelizedPsbt=void 0;var i=t("bjmqu"),s=t("loYOe");class o extends s.PsbtV2{getGlobalSize(){return this.globalMap.size}getGlobalKeysValuesRoot(){return this.globalMerkleMap.commitment()}static createMerkleMap(t){const e=[...t.keys()].sort(),r=e.map((e=>{const r=t.get(e);if(!r)throw new Error("No value for key "+e);return r})),s=e.map((t=>n.from(t,"hex")));return new i.MerkleMap(s,r)}constructor(t){super(),this.inputMerkleMaps=[],this.outputMerkleMaps=[],t.copy(this),this.globalMerkleMap=o.createMerkleMap(this.globalMap);for(let t=0;t<this.getGlobalInputCount();t++)this.inputMerkleMaps.push(o.createMerkleMap(this.inputMaps[t]));this.inputMapCommitments=[...this.inputMerkleMaps.values()].map((t=>t.commitment()));for(let t=0;t<this.getGlobalOutputCount();t++)this.outputMerkleMaps.push(o.createMerkleMap(this.outputMaps[t]));this.outputMapCommitments=[...this.outputMerkleMaps.values()].map((t=>t.commitment()))}}e.exports.MerkelizedPsbt=o})),t.register("bjmqu",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.MerkleMap=void 0;var i=t("htZV9"),s=t("6W3U6");e.exports.MerkleMap=class{commitment(){return n.concat([(0,s.createVarint)(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])}constructor(t,e){if(t.length!=e.length)throw new Error("keys and values should have the same length");for(let e=0;e<t.length-1;e++)if(t[e].toString("hex")>=t[e+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=t,this.keysTree=new i.Merkle(t.map((t=>(0,i.hashLeaf)(t)))),this.values=e,this.valuesTree=new i.Merkle(e.map((t=>(0,i.hashLeaf)(t))))}}})),t.register("loYOe",(function(e,r){var n=t("6rT8n").Buffer,i=e.exports&&e.exports.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),s=e.exports&&e.exports.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=e.exports&&e.exports.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&i(e,t,r);return s(e,t),e};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.PsbtV2=e.exports.NoSuchEntry=e.exports.psbtOut=e.exports.psbtIn=e.exports.psbtGlobal=void 0;const a=o(t("5GnSC"));var u,l,p,h,c,f,d=t("8ziCY"),I=t("6W3U6");(l=u=e.exports.psbtGlobal||(e.exports.psbtGlobal={}))[l.UNSIGNED_TX=0]="UNSIGNED_TX",l[l.XPUB=1]="XPUB",l[l.TX_VERSION=2]="TX_VERSION",l[l.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",l[l.INPUT_COUNT=4]="INPUT_COUNT",l[l.OUTPUT_COUNT=5]="OUTPUT_COUNT",l[l.TX_MODIFIABLE=6]="TX_MODIFIABLE",l[l.VERSION=251]="VERSION",(h=p=e.exports.psbtIn||(e.exports.psbtIn={}))[h.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",h[h.WITNESS_UTXO=1]="WITNESS_UTXO",h[h.PARTIAL_SIG=2]="PARTIAL_SIG",h[h.SIGHASH_TYPE=3]="SIGHASH_TYPE",h[h.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",h[h.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",h[h.BIP32_DERIVATION=6]="BIP32_DERIVATION",h[h.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",h[h.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",h[h.PREVIOUS_TXID=14]="PREVIOUS_TXID",h[h.OUTPUT_INDEX=15]="OUTPUT_INDEX",h[h.SEQUENCE=16]="SEQUENCE",h[h.TAP_KEY_SIG=19]="TAP_KEY_SIG",h[h.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",(f=c=e.exports.psbtOut||(e.exports.psbtOut={}))[f.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",f[f.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",f[f.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",f[f.AMOUNT=3]="AMOUNT",f[f.SCRIPT=4]="SCRIPT",f[f.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION";const g=n.from([112,115,98,116,255]);class E extends Error{}e.exports.NoSuchEntry=E;function T(t,e,r,i){if(!t)throw Error("No such map");const s=new m(e,r),o=t.get(s.toString());if(!o){if(i)return;throw new E(s.toString())}return n.from(o)}e.exports.PsbtV2=class{setGlobalTxVersion(t){this.setGlobal(u.TX_VERSION,M(t))}getGlobalTxVersion(){return this.getGlobal(u.TX_VERSION).readUInt32LE(0)}setGlobalFallbackLocktime(t){this.setGlobal(u.FALLBACK_LOCKTIME,M(t))}getGlobalFallbackLocktime(){var t;return null===(t=this.getGlobalOptional(u.FALLBACK_LOCKTIME))||void 0===t?void 0:t.readUInt32LE(0)}setGlobalInputCount(t){this.setGlobal(u.INPUT_COUNT,v(t))}getGlobalInputCount(){return y(this.getGlobal(u.INPUT_COUNT))}setGlobalOutputCount(t){this.setGlobal(u.OUTPUT_COUNT,v(t))}getGlobalOutputCount(){return y(this.getGlobal(u.OUTPUT_COUNT))}setGlobalTxModifiable(t){this.setGlobal(u.TX_MODIFIABLE,t)}getGlobalTxModifiable(){return this.getGlobalOptional(u.TX_MODIFIABLE)}setGlobalPsbtVersion(t){this.setGlobal(u.VERSION,M(t))}getGlobalPsbtVersion(){return this.getGlobal(u.VERSION).readUInt32LE(0)}setInputNonWitnessUtxo(t,e){this.setInput(t,p.NON_WITNESS_UTXO,_(),e)}getInputNonWitnessUtxo(t){return this.getInputOptional(t,p.NON_WITNESS_UTXO,_())}setInputWitnessUtxo(t,e,r){const n=new d.BufferWriter;n.writeSlice(P(e)),n.writeVarSlice(r),this.setInput(t,p.WITNESS_UTXO,_(),n.buffer())}getInputWitnessUtxo(t){const e=this.getInputOptional(t,p.WITNESS_UTXO,_());if(!e)return;const r=new d.BufferReader(e);return{amount:(0,d.unsafeFrom64bitLE)(r.readSlice(8)),scriptPubKey:r.readVarSlice()}}setInputPartialSig(t,e,r){this.setInput(t,p.PARTIAL_SIG,e,r)}getInputPartialSig(t,e){return this.getInputOptional(t,p.PARTIAL_SIG,e)}setInputSighashType(t,e){this.setInput(t,p.SIGHASH_TYPE,_(),M(e))}getInputSighashType(t){const e=this.getInputOptional(t,p.SIGHASH_TYPE,_());if(e)return e.readUInt32LE(0)}setInputRedeemScript(t,e){this.setInput(t,p.REDEEM_SCRIPT,_(),e)}getInputRedeemScript(t){return this.getInputOptional(t,p.REDEEM_SCRIPT,_())}setInputWitnessScript(t,e){this.setInput(t,p.WITNESS_SCRIPT,_(),e)}getInputWitnessScript(t){return this.getInputOptional(t,p.WITNESS_SCRIPT,_())}setInputBip32Derivation(t,e,r,n){if(33!=e.length)throw new Error("Invalid pubkey length: "+e.length);this.setInput(t,p.BIP32_DERIVATION,e,this.encodeBip32Derivation(r,n))}getInputBip32Derivation(t,e){const r=this.getInputOptional(t,p.BIP32_DERIVATION,e);if(r)return this.decodeBip32Derivation(r)}setInputFinalScriptsig(t,e){this.setInput(t,p.FINAL_SCRIPTSIG,_(),e)}getInputFinalScriptsig(t){return this.getInputOptional(t,p.FINAL_SCRIPTSIG,_())}setInputFinalScriptwitness(t,e){this.setInput(t,p.FINAL_SCRIPTWITNESS,_(),e)}getInputFinalScriptwitness(t){return this.getInput(t,p.FINAL_SCRIPTWITNESS,_())}setInputPreviousTxId(t,e){this.setInput(t,p.PREVIOUS_TXID,_(),e)}getInputPreviousTxid(t){return this.getInput(t,p.PREVIOUS_TXID,_())}setInputOutputIndex(t,e){this.setInput(t,p.OUTPUT_INDEX,_(),M(e))}getInputOutputIndex(t){return this.getInput(t,p.OUTPUT_INDEX,_()).readUInt32LE(0)}setInputSequence(t,e){this.setInput(t,p.SEQUENCE,_(),M(e))}getInputSequence(t){var e,r;return null!==(r=null===(e=this.getInputOptional(t,p.SEQUENCE,_()))||void 0===e?void 0:e.readUInt32LE(0))&&void 0!==r?r:4294967295}setInputTapKeySig(t,e){this.setInput(t,p.TAP_KEY_SIG,_(),e)}getInputTapKeySig(t){return this.getInputOptional(t,p.TAP_KEY_SIG,_())}setInputTapBip32Derivation(t,e,r,n,i){if(32!=e.length)throw new Error("Invalid pubkey length: "+e.length);const s=this.encodeTapBip32Derivation(r,n,i);this.setInput(t,p.TAP_BIP32_DERIVATION,e,s)}getInputTapBip32Derivation(t,e){const r=this.getInput(t,p.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(r)}getInputKeyDatas(t,e){return this.getKeyDatas(this.inputMaps[t],e)}setOutputRedeemScript(t,e){this.setOutput(t,c.REDEEM_SCRIPT,_(),e)}getOutputRedeemScript(t){return this.getOutput(t,c.REDEEM_SCRIPT,_())}setOutputBip32Derivation(t,e,r,n){this.setOutput(t,c.BIP_32_DERIVATION,e,this.encodeBip32Derivation(r,n))}getOutputBip32Derivation(t,e){const r=this.getOutput(t,c.BIP_32_DERIVATION,e);return this.decodeBip32Derivation(r)}setOutputAmount(t,e){this.setOutput(t,c.AMOUNT,_(),P(e))}getOutputAmount(t){const e=this.getOutput(t,c.AMOUNT,_());return(0,d.unsafeFrom64bitLE)(e)}setOutputScript(t,e){this.setOutput(t,c.SCRIPT,_(),e)}getOutputScript(t){return this.getOutput(t,c.SCRIPT,_())}setOutputTapBip32Derivation(t,e,r,n,i){const s=this.encodeTapBip32Derivation(r,n,i);this.setOutput(t,c.TAP_BIP32_DERIVATION,e,s)}getOutputTapBip32Derivation(t,e){const r=this.getOutput(t,c.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(r)}deleteInputEntries(t,e){this.inputMaps[t].forEach(((t,r,n)=>{this.isKeyType(r,e)&&n.delete(r)}))}copy(t){this.copyMap(this.globalMap,t.globalMap),this.copyMaps(this.inputMaps,t.inputMaps),this.copyMaps(this.outputMaps,t.outputMaps)}copyMaps(t,e){t.forEach(((t,r)=>{const n=new Map;this.copyMap(t,n),e[r]=n}))}copyMap(t,e){t.forEach(((t,r)=>e.set(r,n.from(t))))}serialize(){const t=new d.BufferWriter;return t.writeSlice(n.from([112,115,98,116,255])),b(t,this.globalMap),this.inputMaps.forEach((e=>{b(t,e)})),this.outputMaps.forEach((e=>{b(t,e)})),t.buffer()}deserialize(t){const e=new d.BufferReader(t);if(!e.readSlice(5).equals(g))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,e););let r,n,i;try{r=this.getGlobalPsbtVersion()}catch(t){r=0}if(0!==r&&2!==r)throw new Error("Only PSBTs of version 0 or 2 are supported");if(0==r){const t=this.getGlobal(u.UNSIGNED_TX),e=a.Transaction.fromBuffer(t);n=e.ins.length,i=e.outs.length}else n=this.getGlobalInputCount(),i=this.getGlobalOutputCount();for(let t=0;t<n;t++)for(this.inputMaps[t]=new Map;this.readKeyPair(this.inputMaps[t],e););for(let t=0;t<i;t++)for(this.outputMaps[t]=new Map;this.readKeyPair(this.outputMaps[t],e););this.normalizeToV2()}normalizeToV2(){var t;const e=null===(t=this.getGlobalOptional(u.VERSION))||void 0===t?void 0:t.readInt32LE(0);if(2===e)return;if(void 0!==e)throw new Error("Invalid or unsupported value for PSBT_GLOBAL_VERSION");const r=this.getGlobal(u.UNSIGNED_TX),n=a.Transaction.fromBuffer(r);this.setGlobalPsbtVersion(2),this.setGlobalTxVersion(n.version),this.setGlobalFallbackLocktime(n.locktime),this.setGlobalInputCount(n.ins.length),this.setGlobalOutputCount(n.outs.length);for(let t=0;t<n.ins.length;t++)this.setInputPreviousTxId(t,n.ins[t].hash),this.setInputOutputIndex(t,n.ins[t].index),this.setInputSequence(t,n.ins[t].sequence);for(let t=0;t<n.outs.length;t++)this.setOutputAmount(t,n.outs[t].value),this.setOutputScript(t,n.outs[t].script);this.globalMap.delete(u.UNSIGNED_TX.toString(16).padStart(2,"0"))}fromBitcoinJS(t){return this.setGlobalPsbtVersion(2),this.setGlobalTxVersion(t.version),this.setGlobalInputCount(t.data.inputs.length),this.setGlobalOutputCount(t.txOutputs.length),void 0!==t.locktime&&this.setGlobalFallbackLocktime(t.locktime),t.data.inputs.forEach(((e,r)=>{if(function(t){let e;try{a.payments.p2tr({output:t.witnessUtxo.script}),e=!0}catch(t){e=!1}return t&&!!(t.tapInternalKey||t.tapMerkleRoot||t.tapLeafScript&&t.tapLeafScript.length||t.tapBip32Derivation&&t.tapBip32Derivation.length||e)}(e))throw new Error("Taproot inputs not supported");this.setInputPreviousTxId(r,t.txInputs[r].hash),void 0!==t.txInputs[r].sequence&&this.setInputSequence(r,t.txInputs[r].sequence),this.setInputOutputIndex(r,t.txInputs[r].index),void 0!==e.sighashType&&this.setInputSighashType(r,e.sighashType),e.nonWitnessUtxo&&this.setInputNonWitnessUtxo(r,e.nonWitnessUtxo),e.witnessUtxo&&this.setInputWitnessUtxo(r,e.witnessUtxo.value,e.witnessUtxo.script),e.witnessScript&&this.setInputWitnessScript(r,e.witnessScript),e.redeemScript&&this.setInputRedeemScript(r,e.redeemScript),t.data.inputs[r].bip32Derivation.forEach((t=>{if(!/^m\//i.test(t.path))throw new Error("Invalid input bip32 derivation");const e=t.path.replace(/m\//i,"").split("/").map((t=>t.match(/['h]/i)?parseInt(t)+2147483648:Number(t)));this.setInputBip32Derivation(r,t.pubkey,t.masterFingerprint,e)}))})),t.txOutputs.forEach(((t,e)=>{this.setOutputAmount(e,t.value),this.setOutputScript(e,t.script)})),this}readKeyPair(t,e){const r=(0,I.sanitizeBigintToNumber)(e.readVarInt());if(0==r)return!1;return x(t,e.readUInt8(),e.readSlice(r-1),e.readVarSlice()),!0}getKeyDatas(t,e){const r=[];return t.forEach(((t,i)=>{this.isKeyType(i,[e])&&r.push(n.from(i.substring(2),"hex"))})),r}isKeyType(t,e){const r=n.from(t.substring(0,2),"hex").readUInt8(0);return e.some((t=>t==r))}setGlobal(t,e){const r=new m(t,n.from([]));this.globalMap.set(r.toString(),e)}getGlobal(t){return T(this.globalMap,t,_(),!1)}getGlobalOptional(t){return T(this.globalMap,t,_(),!0)}setInput(t,e,r,n){x(this.getMap(t,this.inputMaps),e,r,n)}getInput(t,e,r){return T(this.inputMaps[t],e,r,!1)}getInputOptional(t,e,r){return T(this.inputMaps[t],e,r,!0)}setOutput(t,e,r,n){x(this.getMap(t,this.outputMaps),e,r,n)}getOutput(t,e,r){return T(this.outputMaps[t],e,r,!1)}getMap(t,e){return e[t]?e[t]:e[t]=new Map}encodeBip32Derivation(t,e){const r=new d.BufferWriter;return this.writeBip32Derivation(r,t,e),r.buffer()}decodeBip32Derivation(t){const e=new d.BufferReader(t);return this.readBip32Derivation(e)}writeBip32Derivation(t,e,r){t.writeSlice(e),r.forEach((e=>{t.writeUInt32(e)}))}readBip32Derivation(t){const e=t.readSlice(4),r=[];for(;t.offset<t.buffer.length;)r.push(t.readUInt32());return{masterFingerprint:e,path:r}}encodeTapBip32Derivation(t,e,r){const n=new d.BufferWriter;return n.writeVarInt(t.length),t.forEach((t=>{n.writeSlice(t)})),this.writeBip32Derivation(n,e,r),n.buffer()}decodeTapBip32Derivation(t){const e=new d.BufferReader(t),r=(0,I.sanitizeBigintToNumber)(e.readVarInt()),n=[];for(let t=0;t<r;t++)n.push(e.readSlice(32));const i=this.readBip32Derivation(e);return Object.assign({hashes:n},i)}constructor(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}};class m{toString(){const t=new d.BufferWriter;return this.toBuffer(t),t.buffer().toString("hex")}serialize(t){t.writeVarInt(1+this.keyData.length),this.toBuffer(t)}toBuffer(t){t.writeUInt8(this.keyType),t.writeSlice(this.keyData)}constructor(t,e){this.keyType=t,this.keyData=e}}class w{serialize(t){this.key.serialize(t),t.writeVarSlice(this.value)}constructor(t,e){this.key=t,this.value=e}}function S(t){return new m(t.readUInt8(0),t.slice(1))}function b(t,e){for(let[r,i]of[...e].sort((([t],[e])=>t.localeCompare(e)))){new w(S(n.from(r,"hex")),i).serialize(t)}t.writeUInt8(0)}function _(){return n.from([])}function x(t,e,r,n){const i=new m(e,r);t.set(i.toString(),n)}function M(t){const e=n.alloc(4);return e.writeUInt32LE(t,0),e}function P(t){return(0,d.unsafeTo64bitLE)(t)}function v(t){const e=new d.BufferWriter;return e.writeVarInt(t),e.buffer()}function y(t){return(0,I.sanitizeBigintToNumber)(new d.BufferReader(t).readVarInt())}})),t.register("lu4xX",(function(e,r){var n=t("6rT8n").Buffer;Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DefaultWalletPolicy=e.exports.WalletPolicy=void 0;var i=t("5GnSC"),s=t("8ziCY"),o=t("htZV9");class a{getId(){return i.crypto.sha256(this.serialize())}serialize(){const t=this.keys.map((t=>n.from(t,"ascii"))),e=new o.Merkle(t.map((t=>(0,o.hashLeaf)(t)))),r=new s.BufferWriter;return r.writeUInt8(2),r.writeVarSlice(n.from(this.name,"ascii")),r.writeVarInt(this.descriptorTemplate.length),r.writeSlice(i.crypto.sha256(n.from(this.descriptorTemplate))),r.writeVarInt(this.keys.length),r.writeSlice(e.getRoot()),r.buffer()}constructor(t,e,r){this.name=t,this.descriptorTemplate=e,this.keys=r}}e.exports.WalletPolicy=a;e.exports.DefaultWalletPolicy=class extends a{constructor(t,e){super("",t,[e])}}}));
//# sourceMappingURL=main.488cbe0e.js.map
define=__define;})(window.define);