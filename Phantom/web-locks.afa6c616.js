(function(define){var __define;"function"==typeof define&&define.amd&&(__define=define,define=null);
var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire1d24;e.register("5Hfeb",(function(t,s){var r=e("2p5of").EventEmitter,n=e("eUijm");const{isMainThread:o,parentPort:i}=n,a=!o;let l=null;class c{enter(e){return new Promise((t=>{this.queue.push({handler:e,resolve:t}),this.trying=!0,setTimeout((()=>{this.tryEnter()}),0)}))}tryEnter(){if(0===this.queue.length)return;if(0===Atomics.exchange(this.flag,0,0))return;this.owner=!0,this.trying=!1;const{handler:e,resolve:t}=this.queue.shift();e(this).finally((()=>{this.leave(),t()}))}leave(){if(!this.owner)return;Atomics.store(this.flag,0,1),this.owner=!1;const e={webLocks:!0,kind:"leave",name:this.name};l.send(e),this.tryEnter()}constructor(e,t="exclusive",s=null){this.name=e,this.mode=t,this.queue=[],this.owner=!1,this.trying=!1,this.buffer=s||new SharedArrayBuffer(4),this.flag=new Int32Array(this.buffer,0,1),s||Atomics.store(this.flag,0,1)}}class h{constructor(e){const t=[],s=[];this.held=t,this.pending=s;for(const r of e)r.queue.length>0&&s.push(...r.queue),r.owner&&t.push(r)}}class u extends Error{constructor(e){super(e),this.name="AbortError"}}class f extends r{constructor(){super(),this.aborted=!1,this.on("abort",(()=>{this.aborted=!0}))}}l=new class{async request(e,t,s){"function"==typeof t&&(s=t,t={});const{mode:r="exclusive",signal:n=null}=t;let o=this.collection.get(e);if(!o){o=new c(e,r),this.collection.set(e,o);const{buffer:t}=o,s={webLocks:!0,kind:"create",name:e,mode:r,buffer:t};l.send(s)}const i=o.enter(s);let a=null;n?(a=new Promise(((e,t)=>{n.on("abort",t)})),await Promise.race([i,a])):await i,setTimeout((()=>{o.tryEnter()}),0)}query(){const e=new h;return Promise.resolve(e)}attach(e){this.workers.add(e),e.on("message",(t=>{for(const s of this.workers)s!==e&&s.postMessage(t);this.receive(t)}))}send(e){if(a)i.postMessage(e);else for(const t of this.workers)t.postMessage(e)}receive(e){if(!e.webLocks)return;const{kind:t,name:s,mode:r,buffer:n}=e;if("create"!==t){if("leave"===t)for(const e of this.collection.values())e.name===s&&e.trying&&e.tryEnter()}else{const e=new c(s,r,n);this.collection.set(s,e)}}constructor(){this.collection=new Map,this.workers=new Set,a&&i.on("message",(e=>{this.receive(e)}))}},t.exports={locks:l,AbortController:class{abort(){const e=new u("The request was aborted");this.signal.emit("abort",e)}constructor(){this.signal=new f}}}}));
//# sourceMappingURL=web-locks.afa6c616.js.map
define=__define;})(window.define);